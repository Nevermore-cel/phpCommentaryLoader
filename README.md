# Поиск записей по комментариям

Этот проект представляет собой веб-приложение на PHP, которое позволяет искать записи (посты) по содержимому комментариев к ним. Данные для демонстрации импортируются из открытого API `jsonplaceholder.typicode.com`.

## Содержание

1.  [О проекте](#о-проекте)
2.  [Функционал](#функционал)
3.  [Технологии](#технологии)
4.  [Установка и настройка](#установка-и-настройка)
    *   [Предварительные требования](#предварительные-требования)
    *   [Настройка базы данных](#настройка-базы-данных)
    *   [Импорт данных](#импорт-данных)
    *   [Запуск проекта](### Запуск проекта на примере Xampp)
5.  [Структура проекта](#структура-проекта)
6.  [Использование](#использование)

---

## О проекте

Основная идея проекта — продемонстрировать:
*   Взаимодействие с базой данных MySQL с использованием PDO.
*   Выполнение поисковых запросов в базе данных, включая LIKE-операторы.
*   Импорт данных из внешнего API (`jsonplaceholder.typicode.com`).
*   Создание простого веб-интерфейса с формой поиска и отображением результатов.
*   Обработку ошибок и безопасное отображение данных (экранирование HTML).

## Функциональность

*   **Импорт данных:** Скрипт `import_data.php` загружает записи и комментарии с API `jsonplaceholder.typicode.com` и сохраняет их в локальную базу данных MySQL.
*   **Поиск:** Пользователь может ввести текст в поле поиска. Поиск осуществляется по содержимому поля `body` в таблице `comments`.
*   **Минимальная длина запроса:** Поиск выполняется только при вводе не менее 3 символов.
*   **Подсветка результатов:** Найденные фрагменты текста в теле комментариев подсвечиваются тегом `<mark>`.
*   **Отображение:** Результаты выводятся с группировкой по постам, отображая заголовок поста и соответствующие комментарии.
*   **Безопасность:** Используется `htmlspecialchars` для предотвращения XSS-атак.
*   **Стилизация:** Присутствует базовый CSS для улучшения внешнего вида.

## Технологии

*   **PHP:** Язык программирования.
*   **MySQL:** Система управления базами данных.
*   **PDO (PHP Data Objects):** Уровень абстракции для доступа к базам данных.
*   **cURL:** Библиотека PHP для выполнения HTTP-запросов (используется для импорта данных).
*   **JSON:** Формат обмена данными.
*   **HTML/CSS:** Для структуры и оформления веб-страницы.

## Установка и настройка

### Требования

*   **PHP:** Версия 7.4 или выше.
*   **MySQL:** Установленный и запущенный сервер MySQL.
*   **PHP Extensions:** `pdo`, `pdo_mysql`, `curl` (обычно включены по умолчанию).

### Клонирование репозитория:
   ```bash
    git clone https://github.com/Nevermore-cel/phpCommentaryLoader.git
    cd phpCommentaryLoader
   ```

### Настройка базы данных

1.  **Создайте базу данных:**
    Используйте предоставленный SQL-скрипт для создания базы данных `blog_db` и необходимых таблиц (`posts`, `comments`).

    ```sql
    -- Создание базы данных
    CREATE DATABASE IF NOT EXISTS blog_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
    USE blog_db;

    -- Таблица для записей блога
    CREATE TABLE IF NOT EXISTS posts (
        id INT PRIMARY KEY,
        user_id INT NOT NULL,
        title VARCHAR(255) NOT NULL,
        body TEXT NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        INDEX idx_user_id (user_id)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

    -- Таблица для комментариев
    CREATE TABLE IF NOT EXISTS comments (
        id INT PRIMARY KEY,
        post_id INT NOT NULL,
        name VARCHAR(255) NOT NULL,
        email VARCHAR(255) NOT NULL,
        body TEXT NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        INDEX idx_post_id (post_id),
        FULLTEXT idx_body (body),
        FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
    ```

2.  **Настройте подключение:**
    Откройте файл `config/database.php` и укажите правильные параметры подключения к вашей базе данных:

    ```php
    <?php
    define('DB_HOST', 'localhost');      // Ваш хост MySQL (например, 'localhost', '127.0.0.1')
    define('DB_NAME', 'blog_db');        // Имя вашей базы данных
    define('DB_USER', 'root');           // Имя пользователя MySQL
    define('DB_PASS', '');               // Пароль пользователя MySQL
    define('DB_CHARSET', 'utf8mb4');     // Кодировка базы данных
    ?>
    ```

### Импорт данных

После настройки базы данных, выполните скрипт импорта данных. Это можно сделать, запустив его из командной строки:

```bash
php import_data.php
```

Этот скрипт загрузит данные с `https://jsonplaceholder.typicode.com/posts` и `https://jsonplaceholder.typicode.com/comments` и заполнит соответствующие таблицы в вашей базе данных.

### Запуск проекта на примере Xampp
1. Запустите модули apache и mySQL.
2. Создайте схему и таблицы с помощью sql запросов в phpMyAdmin (они описанны в пунке [Настройка базы данных](#настройка-базы-данных) )
3. В терминале запустите import.php для загрузки данных с api командой 
```bash 
php import_data.php
```
4. Перейдите в терминале в дирректорию проекта, запустите хост командой 
```bash 
php -S localhost:8000
```




## Структура проекта

```
.
├── config/
│   └── database.php       # Настройки подключения к БД
├── css/
│   └── style.css          # Стили для веб-интерфейса
├── import_data.php        # Скрипт импорта данных из API
├── index.php              # Основной файл: форма поиска и отображение результатов
├── search_logic.php       # Файл с логикой поиска (включается в index.php)
└── README.md              # Данный файл
```

## Использование

1.  **Введите текст:** Введите не менее 3 символов в поле поиска.
2.  **Нажмите "Найти":** Программа выполнит поиск по комментариям.
3.  **Просмотрите результаты:** Если найдены совпадения, вы увидите список постов, к которым относятся комментарии, с подсветкой искомого текста. Если ничего не найдено, появится соответствующее сообщение.
